@using Distributor.Helpers
@using Distributor.Enums
@model IList<Distributor.ViewModels.AvailableListingGeneralViewModel>

@{
    //set up the breadcrumb trail so that this can be passed to the details screen for building it's own breadcrumb as the detail screen is called from multiple places
    string breadcrumb = "";
    string callingActionDisplayName = "Available";
}

<div class="row">
    <div class="col-md-12">
        <h1 class="page-header">General Information <small>Available</small></h1>
    </div>
</div>

@if (Model.Count > 0)
{
    <div class="row">
        <div class="panel panel-default">
            <div class="panel-heading clearfix">
                <div class="col-md-4"><label>Search filters</label></div>
                <div class="col-md-7" style="font-size:small">
                    <div class="col-md-6">
                        <label class="col-md-12" style="font-weight:normal">
                            Distance: @Html.EditorFor(searchItem => Model[0].MaxDistance, new { htmlAttributes = new { @class = "input-sm", id = "MaxDistance" } }) miles
                        </label>
                    </div>
                    <div class="col-md-6">
                        <label class="col-md-12" style="font-weight:normal">
                            Age: @Html.EditorFor(searchItem => Model[0].MaxAge, new { htmlAttributes = new { @class = "input-sm", id = "MaxAge" } }) days
                        </label>
                    </div>
                </div>
                <div class="col-md-1"><button type="button" name="searchbutton" class="btn btn-default btn-xs btn-block" onclick="location.href='@Url.Action("Available", "GeneralInfo")?maxDistance=' + document.getElementById('MaxDistance').value + '&maxAge=' + document.getElementById('MaxAge').value"><span class="glyphicon glyphicon-search"></span></button></div>
            </div>
        </div>
    </div>
}
else
{
    <div class="row">
        <div class="panel panel-default">
            <div class="panel-heading clearfix">
                <div class="col-md-4"><label>Search filters</label></div>
                <div class="col-md-7" style="font-size:small">
                    <div class="col-md-6">
                        <label class="col-md-12" style="font-weight:normal">
                            Distance: @Html.Editor("MaxDistance", new { htmlAttributes = new { @class = "input-sm", id = "MaxDistance" } }) miles
                        </label>
                    </div>
                    <div class="col-md-6">
                        <label class="col-md-12" style="font-weight:normal">
                            Age: @Html.Editor("MaxAge", new { htmlAttributes = new { @class = "input-sm", id = "MaxAge" } }) days
                        </label>
                    </div>
                </div>
                <div class="col-md-1"><button type="button" name="searchbutton" class="btn btn-default btn-xs btn-block" onclick="location.href='@Url.Action("Available", "GeneralInfo")?maxDistance=' + document.getElementById('MaxDistance').value + '&maxAge=' + document.getElementById('MaxAge').value"><span class="glyphicon glyphicon-search"></span></button></div>
            </div>
        </div>
    </div>
}

<div class="row">
        <div class="col-md-12">
            <div class="panel panel-green">
                <div class="panel-heading">Available listings</div>
                <div class="panel-body">
                    <table style="width:100%;" class="table table-striped table-bordered table-hover" id="availableTable">
                        <thead>
                            <tr class="primary">
                                <th>Description</th>
                                <th>Type</th>
                                <th>Qty Available</th>
                                <th>UoM</th>
                                <th>Available To</th>
                                <th>Condition</th>
                                <th>Expiry Date</th>
                                <th>Delivery</th>
                                <th>Supplier</th>
                                <th>Distance</th>
                                <th></th>
                            </tr>
                        </thead>

                        <tbody>
                            @for (int i = 0; i < Model.Count(); i++)
                            {
                                var listingId = Model[i].ListingId;

                                <tr>
                                    @Html.HiddenFor(modelItem => Model[i].ListingId)
                                    @Html.HiddenFor(modelItem => Model[i].ItemDescription)
                                    @Html.HiddenFor(modelItem => Model[i].QuantityOutstanding)
                                    @Html.HiddenFor(modelItem => Model[i].UoM)
                                    @Html.HiddenFor(modelItem => Model[i].DeliveryAvailable)
                                    @Html.HiddenFor(modelItem => Model[i].SupplierDetails)
                                    @Html.HiddenFor(modelItem => Model[i].Distance)
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].ItemDescription)</td>
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].ItemType)</td>
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].QuantityOutstanding)</td>
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].UoM)</td>
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].AvailableTo)</td>
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].ItemCondition)</td>
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].ExpiryDate)</td>
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].DeliveryAvailable)</td>
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].SupplierDetails)</td>
                                    <td onclick="location.href='@Url.Action("DisplayAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName, displayOnly = true })'">@Html.DisplayFor(modelItem => Model[i].Distance)</td>
                                    <td><a class="btn btn-primary" href='@Url.Action("OfferAvailable", "GeneralInfo", new { id = listingId, breadcrumb = breadcrumb, callingActionDisplayName = callingActionDisplayName })'><span class="glyphicon glyphicon-edit"></span></a></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>




@section Scripts {
    <script type="text/javascript">

        //Render tables
        $(document).ready(function () {
            $('#availableTable').dataTable({
                'columns': [
                    null,
                    null,
                    null,
                    null,
                    null,
                    null,
                    null,
                    null,
                    null,
                    null,
                    { 'orderable': false }
                ],
                responsive: true
            });
        });
    </script>
}